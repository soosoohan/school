
function saveProgress() {
    try {
        const wordpoolName = wordpoolUrl.split('/').pop().replace('.json', '');
        const allProgress = JSON.parse(localStorage.getItem('moeumschool_progress') || '{}');
        const progress = allProgress[wordpoolName] || { attempts: [] };
        const today = new Date().toISOString().split('T')[0];
   
     // ì²«íŒì—ì„œ í‹€ë¦° ë¬¸ì œê°€ 0ê°œì¼ ë•Œ = ðŸ† íŠ¸ë¡œí”¼ (5íšŒ ì™„ë£Œ)
        if (isFirstAttempt && firstAttemptWrongAnswers.length === 0) {
            progress.attempts = [
                { date: today, accuracy: 100, stage: 0 },  // â­ stage ì¶”ê°€
                { date: today, accuracy: 100, stage: 1 },
                { date: today, accuracy: 100, stage: 2 },
                { date: today, accuracy: 100, stage: 3 },
                { date: today, accuracy: 100, stage: 4 }
            ];
            allProgress[wordpoolName] = progress;
            localStorage.setItem('moeumschool_progress', JSON.stringify(allProgress));
            console.log('ðŸ† ì²«íŒ 100ì ! íŠ¸ë¡œí”¼ íšë“!');
            return true;
        }
   
else if (isFirstAttempt && firstAttemptWrongAnswers.length > 0) {
    progress.attempts.push({ date: today, accuracy: 100, stage: 0 });
    allProgress[wordpoolName] = progress;
    localStorage.setItem('moeumschool_progress', JSON.stringify(allProgress));
    
    // ë³µìŠµ ì¼ì • ì €ìž¥
    firstAttemptWrongAnswers.forEach(item => {
        saveForReview(item.text, item.hint);
    });
    
    return true;
}
// ë³µìŠµ ì™„ë£Œ ì‹œ (2ì°¨, 3ì°¨, 4ì°¨, 5ì°¨)
else if (!isFirstAttempt) {
    const currentStage = progress.attempts.length; // í˜„ìž¬ ëª‡ íšŒì°¨ì¸ì§€
    progress.attempts.push({ date: today, accuracy: 100, stage: currentStage });
    allProgress[wordpoolName] = progress;
    localStorage.setItem('moeumschool_progress', JSON.stringify(allProgress));
    
    // â­ completedReviews ì¦ê°€!
    const allReviews = JSON.parse(localStorage.getItem('moeumschool_reviews') || '{}');
    if (allReviews[wordpoolName]) {
        allReviews[wordpoolName].forEach(item => {
            if (item.completedReviews < 4) {
                item.completedReviews++;
            }
        });
        localStorage.setItem('moeumschool_reviews', JSON.stringify(allReviews));
    }
    
    console.log(`${currentStage}íšŒ ë³µìŠµ ì™„ë£Œ!`);
    
    // 5íšŒ ì™„ë£Œ ì‹œ íŠ¸ë¡œí”¼
    if (currentStage === 4) {
        console.log('ðŸ† 5íšŒ ì™„ë£Œ! íŠ¸ë¡œí”¼ íšë“!');
        return 'trophy';
    }
    
    return true;
}

    } catch (error) {
        console.error('ì§„ë„ ì €ìž¥ ì‹¤íŒ¨:', error);
        return false;
    }
}
